<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ultra Stok Y√∂netim Asistanƒ±</title>
<style>
body{margin:0;background:linear-gradient(135deg,#0f172a,#1e293b);font-family:-apple-system,BlinkMacSystemFont,Segoe UI;color:#fff;text-align:center}
h1{margin-top:20px}
.container{max-width:900px;margin:auto;padding:15px}
.card{background:rgba(255,255,255,0.05);backdrop-filter:blur(12px);padding:20px;border-radius:20px;margin-top:20px;box-shadow:0 0 40px rgba(0,0,0,0.4)}
button{width:100%;padding:15px;margin-top:10px;border:none;border-radius:12px;background:#2563eb;color:white;font-size:16px}
#log{height:180px;overflow:auto;text-align:left;font-size:14px;margin-top:10px}
#result{font-size:40px;font-weight:bold;margin-top:20px}
.blink{animation:blink 1s infinite}
@keyframes blink{0%{opacity:1}50%{opacity:.3}100%{opacity:1}}
.green{color:#22c55e}
.orange{color:#f59e0b}
.red{color:#ef4444}
</style>
</head>
<body>

<h1>üéôÔ∏è ULTRA STOK ASƒ∞STANI</h1>
<div class="container">

<div class="card">
<button onclick="initSystem()">Sistemi Ba≈ülat</button>
<button onclick="startListening()">Konu≈ü</button>
<button onclick="resetFlow()">Ba≈üka Soru Sor</button>
<div id="log"></div>
</div>

<div class="card">
<div id="result"></div>
</div>

</div>

<script>
let state="idle"
let currentFirma=null
let currentUrun=null

const firmaAlias={
"BIM":"BIM","Bƒ∞M":"BIM",
"FILE":"FILE","Fƒ∞LE":"FILE",
"METRO":"METRO",
"KNORR":"KNORR","KINOR":"KNORR"
}

const data=[
{firma:"BIM",urun:"KIMYON",min:20000},
{firma:"BIM",urun:"HINDISTAN CEVIZI",min:30000},
{firma:"BIM",urun:"NANE",min:10000},
{firma:"BIM",urun:"SUSAM",min:25000},
{firma:"BIM",urun:"TARCIN",min:10000},
{firma:"BIM",urun:"COREKOTU",min:15000},
{firma:"BIM",urun:"PUL BIBER",min:80000},
{firma:"BIM",urun:"KARABIBER",min:30000},
{firma:"BIM",urun:"ACI TOZ BIBER",min:15000},
{firma:"BIM",urun:"TATLI TOZ BIBER",min:15000},
{firma:"BIM",urun:"KEKIK",min:15000},
{firma:"BIM",urun:"GALETA UNU",min:150000},
{firma:"BIM",urun:"MISIR UNU",min:150000},

{firma:"FILE",urun:"KARABIBER",min:3000},
{firma:"FILE",urun:"TARCIN",min:3000},
{firma:"FILE",urun:"ZERDECAL",min:3000},
{firma:"FILE",urun:"KEKIK",min:5000},
{firma:"FILE",urun:"ISOT",min:10000},

{firma:"METRO",urun:"TATLI TOZ BIBER",min:1000},
{firma:"METRO",urun:"CILEKLI PUDING",min:2000},
{firma:"METRO",urun:"COREK OTU",min:1000},
{firma:"METRO",urun:"HINDISTAN CEVIZI",min:2000},
{firma:"METRO",urun:"ISOT",min:1500},
{firma:"METRO",urun:"KAKAOLU PUDING",min:5000},
{firma:"METRO",urun:"KARABIBER",min:5000},
{firma:"METRO",urun:"KARANFIL",min:250},
{firma:"METRO",urun:"KEKIK",min:2500},
{firma:"METRO",urun:"KIMYON",min:3000},
{firma:"METRO",urun:"KORI",min:1000},
{firma:"METRO",urun:"KUS UZUMU",min:1000},
{firma:"METRO",urun:"LIMON TUZU",min:3000},
{firma:"METRO",urun:"MAVI HASHAS",min:500},
{firma:"METRO",urun:"MUZLU PUDING",min:2000},
{firma:"METRO",urun:"NANE",min:3000},
{firma:"METRO",urun:"PANKO (3004)",min:15000},
{firma:"METRO",urun:"PUL BIBER",min:20000},
{firma:"METRO",urun:"TOZ SARIMSAK",min:1000},
{firma:"METRO",urun:"SUMAK",min:3000},
{firma:"METRO",urun:"SUSAM",min:2000},
{firma:"METRO",urun:"TANE KARABIBER",min:500},
{firma:"METRO",urun:"TARCIN",min:300},
{firma:"METRO",urun:"TEMPURA UNU",min:500},
{firma:"METRO",urun:"VANILYALI PUDING",min:1000},
{firma:"METRO",urun:"YENIBAHAR",min:250},
{firma:"METRO",urun:"TOZ ZERDECAL",min:500},

{firma:"KNORR",urun:"HINDISTAN CEVIZI",min:2000},
{firma:"KNORR",urun:"KARABIBER",min:5000},
{firma:"KNORR",urun:"KEKIK",min:2500},
{firma:"KNORR",urun:"KIMYON",min:3000},
{firma:"KNORR",urun:"NANE",min:2000},
{firma:"KNORR",urun:"KNORR PANKO (3002)",min:5000},
{firma:"KNORR",urun:"KNORR PUL BIBER",min:5000},
{firma:"KNORR",urun:"TATLI TOZ BIBER",min:5000},
{firma:"KNORR",urun:"ZENCEFIL",min:2000},
{firma:"KNORR",urun:"ZERDECAL",min:3000}
]

function normalize(t){return t.toUpperCase().replace(/ƒ∞/g,"I").replace(/≈û/g,"S").replace(/ƒû/g,"G").replace(/√ú/g,"U").replace(/√ñ/g,"O").replace(/√á/g,"C")}
function speak(t){speechSynthesis.cancel();let u=new SpeechSynthesisUtterance(t);u.lang="tr-TR";speechSynthesis.speak(u)}
function log(t){document.getElementById("log").innerHTML+="<div>"+t+"</div>"}

function initSystem(){state="firma";speak("Merhaba. Hangi firma?")}

function resetFlow(){state="firma";currentFirma=null;currentUrun=null;document.getElementById("result").innerHTML="";speak("Hangi firma?")}

function startListening(){
const SR=window.SpeechRecognition||window.webkitSpeechRecognition
if(!SR){alert("Tarayƒ±cƒ± desteklemiyor");return}
let r=new SR()
r.lang="tr-TR"
r.start()
r.onresult=e=>{
let text=e.results[0][0].transcript
log("üë§ "+text)
process(text)
}
}

function process(text){
let n=normalize(text)

if(state==="firma"){
for(let k in firmaAlias){
if(n.includes(normalize(k))){
currentFirma=firmaAlias[k]
state="urun"
speak("Hangi hammadde?")
return
}}
speak("Firmayƒ± anlayamadƒ±m")
return
}

if(state==="urun"){
let clean=n.replace(/\s+/g,"")
let match=data.find(d=>d.firma===currentFirma && clean.includes(d.urun.replace(/\s+/g,"")))
if(!match){speak("Hammaddeyi anlayamadƒ±m");return}
currentUrun=match.urun
state="stok"
speak("Depoda ka√ß kilogram var?")
return
}

if(state==="stok"){
let kg=parseQuantity(n)
if(kg==null){speak("Miktarƒ± anlayamadƒ±m");return}
let rec=data.find(d=>d.firma===currentFirma && d.urun===currentUrun)
let min=rec.min
let result=document.getElementById("result")

if(kg<min){
let need=min-kg
let ton=need/1000
result.className="blink red"
result.innerHTML=ton.toFixed(2)+" TON Sƒ∞PARƒ∞≈û"
speak(formatSpeechTon(ton)+" sipari≈ü vermelisin")
}else{
result.className="green"
result.innerHTML="STOK YETERLƒ∞"
speak("Stok yeterli")
}
state="idle"
}
}

function parseQuantity(text){
if(text.includes("BUCUK")){
let num=text.match(/(\d+)/)
if(num)return(parseInt(num[0])+0.5)*1000
}
let num=text.match(/(\d+(\.\d+)?)/)
if(num){
let val=parseFloat(num[0])
if(text.includes("TON"))return val*1000
return val
}
return null
}

function formatSpeechTon(ton){
let int=Math.floor(ton)
let dec=ton-int
if(dec===0.5)return int+" bu√ßuk ton"
if(dec===0)return int+" ton"
return Math.round(ton*1000)+" kilogram"
}
</script>

</body>
</html>
